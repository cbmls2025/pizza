<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Pizzaria Del√≠cia</title>

    <link rel="stylesheet" href="Globals.css">

</head>
<body class="checkout-page">

<header>üçï Checkout - Pizzaria Del√≠cia</header>

<div class="checkout-container">
    <!-- RESUMO DO CARRINHO -->
    <section class="resumo-carrinho">
        <h2>Resumo do Pedido</h2>
        <ul id="resumoCarrinho" class="resumo-list"></ul>
        <div class="resumo-total">Total do pedido: R$ <span id="totalCheckout">0.00</span></div>
    </section>

    <h2>Escolha a Forma de Pagamento</h2>

    <label for="pagamento">Forma de pagamento:</label>
    <select id="pagamento">
        <option>PIX</option>
        <option>Cart√£o de Cr√©dito</option>
        <option>Cart√£o de D√©bito</option>
        <option>Pagar na Entrega</option>
    </select>

    <h2>Endere√ßo de Entrega</h2>

    <input type="text" id="rua" placeholder="Rua / Avenida" required>
    <input type="text" id="numero" placeholder="N√∫mero" required>
    <input type="text" id="bairro" placeholder="Bairro" required>
    <input type="text" id="cidade" placeholder="Cidade" required>
    <input type="text" id="cep" placeholder="CEP" required>

    <!-- üî• BOT√ÉO COM VALIDA√á√ÉO -->
    <button id="btnFinalizar" onclick="validarCampos()">
        Finalizar Pedido e Pagar
    </button>

    <div class="painel-pagamentos">
        <h3>üì• Painel de Pagamentos</h3>
        <p>Ap√≥s finalizar o pedido, o pagamento ser√° processado pelo Mercado Pago.</p>
    </div>

</div>

<script>
function validarCampos() {

    let rua = document.getElementById('rua').value.trim();
    let numero = document.getElementById('numero').value.trim();
    let bairro = document.getElementById('bairro').value.trim();
    let cidade = document.getElementById('cidade').value.trim();
    let cep = document.getElementById('cep').value.trim();

    if (rua === "" || numero === "" || bairro === "" || cidade === "" || cep === "") {
        alert("‚ö† Por favor, preencha todos os campos de endere√ßo antes de continuar.");
        return;
    }

    // Verifica se h√° valor salvo em pedidoTotal e redireciona com ele
    let pedidoTotal = parseFloat(localStorage.getItem('pedidoTotal') || '0');

    if (!pedidoTotal || pedidoTotal <= 0) {
        alert('O carrinho est√° vazio ‚Äî adicione itens antes de finalizar o pedido.');
        return;
    }

    // Redireciona para o pagamento usando apenas o amount salvo (comportamento anterior)
    const mercadoLink = `https://link.mercadopago.com.br/pizzamercado?amount=${pedidoTotal.toFixed(2)}`;
    window.location.href = mercadoLink;
}

// Carrega itens do carrinho quando a p√°gina for carregada
document.addEventListener('DOMContentLoaded', function() {
    carregarCarrinhoCheckout();
});

function carregarCarrinhoCheckout() {
    const carrinho = JSON.parse(localStorage.getItem('carrinhoPizzaria')) || [];
    const resumoEl = document.getElementById('resumoCarrinho');
    const totalEl = document.getElementById('totalCheckout');
    const btnFinalizar = document.getElementById('btnFinalizar');

    resumoEl.innerHTML = '';
    let soma = 0;

    if (!carrinho || carrinho.length === 0) {
        resumoEl.innerHTML = '<li class="resumo-item empty">Seu carrinho est√° vazio.</li>';
        totalEl.textContent = '0.00';
        if (btnFinalizar) { btnFinalizar.disabled = true; btnFinalizar.style.opacity = '0.6'; }
        localStorage.removeItem('pedidoTotal');
        return;
    }

    carrinho.forEach(item => {
        const li = document.createElement('li');
        li.className = 'resumo-item';
        // item.preco pode ser number; garantir toFixed
        li.textContent = `${item.nome} ‚Äî R$ ${Number(item.preco).toFixed(2)}`;
        resumoEl.appendChild(li);
        soma += Number(item.preco);
    });

    totalEl.textContent = soma.toFixed(2);
    if (btnFinalizar) { btnFinalizar.disabled = false; btnFinalizar.style.opacity = '1'; }

    // salvar total para uso ao finalizar
    localStorage.setItem('pedidoTotal', soma.toFixed(2));
}
</script>

</body>
</html>
